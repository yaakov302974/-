<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>×”×¦×”×¨×ª ×”×•×Ÿ â€” ×˜×•×¤×¡ ×œ×§×•×—</title>
<link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;900&family=Frank+Ruhl+Libre:wght@300;400;700&display=swap" rel="stylesheet">
<style>
  :root {
    --ink: #1a1a2e;
    --paper: #f5f0e8;
    --gold: #c9a84c;
    --gold-light: #e8d5a3;
    --deep: #0f3460;
    --accent: #e94560;
    --muted: #6b6b7b;
    --border: #d4c9b0;
    --success: #2d6a4f;
    --card: #fffdf7;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Heebo', sans-serif;
    background: var(--paper);
    color: var(--ink);
    min-height: 100vh;
    background-image: 
      radial-gradient(ellipse at 20% 50%, rgba(201,168,76,0.08) 0%, transparent 60%),
      radial-gradient(ellipse at 80% 20%, rgba(15,52,96,0.06) 0%, transparent 50%);
  }

  /* HEADER */
  .header {
    background: var(--deep);
    padding: 40px 60px;
    position: relative;
    overflow: hidden;
  }
  .header::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -10%;
    width: 500px;
    height: 500px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(201,168,76,0.15) 0%, transparent 70%);
    pointer-events: none;
  }
  .header-inner {
    max-width: 860px;
    margin: 0 auto;
    position: relative;
    z-index: 1;
  }
  .firm-name {
    font-family: 'Frank Ruhl Libre', serif;
    font-size: 13px;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--gold);
    margin-bottom: 12px;
    opacity: 0.9;
  }
  .header h1 {
    font-family: 'Frank Ruhl Libre', serif;
    font-size: clamp(28px, 5vw, 44px);
    font-weight: 700;
    color: #fff;
    line-height: 1.2;
  }
  .header h1 span {
    color: var(--gold);
  }
  .header-sub {
    margin-top: 12px;
    color: rgba(255,255,255,0.6);
    font-size: 15px;
    font-weight: 300;
  }

  /* PROGRESS */
  .progress-bar {
    background: var(--deep);
    padding: 0 60px 24px;
    border-bottom: 1px solid rgba(201,168,76,0.3);
  }
  .progress-inner {
    max-width: 860px;
    margin: 0 auto;
    display: flex;
    gap: 6px;
    align-items: center;
  }
  .step-dot {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background: rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    color: rgba(255,255,255,0.4);
    flex-shrink: 0;
    transition: all 0.3s;
    cursor: pointer;
  }
  .step-dot.active {
    background: var(--gold);
    border-color: var(--gold);
    color: var(--deep);
    font-weight: 700;
  }
  .step-dot.done {
    background: rgba(201,168,76,0.3);
    border-color: var(--gold);
    color: var(--gold);
  }
  .step-line {
    flex: 1;
    height: 1px;
    background: rgba(255,255,255,0.15);
  }
  .step-label {
    font-size: 11px;
    color: rgba(255,255,255,0.4);
    margin-top: 6px;
    text-align: center;
  }
  .step-group {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
  }

  /* MAIN */
  .main {
    max-width: 860px;
    margin: 0 auto;
    padding: 40px 20px 80px;
  }

  /* SECTIONS */
  .section {
    display: none;
    animation: fadeSlide 0.4s ease;
  }
  .section.active {
    display: block;
  }

  @keyframes fadeSlide {
    from { opacity: 0; transform: translateY(12px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .section-header {
    display: flex;
    align-items: flex-start;
    gap: 20px;
    margin-bottom: 32px;
  }
  .section-number {
    font-family: 'Frank Ruhl Libre', serif;
    font-size: 56px;
    font-weight: 700;
    color: var(--gold);
    line-height: 1;
    opacity: 0.4;
    flex-shrink: 0;
    margin-top: -8px;
  }
  .section-title {
    font-family: 'Frank Ruhl Libre', serif;
    font-size: 24px;
    font-weight: 700;
    color: var(--deep);
    line-height: 1.3;
  }
  .section-desc {
    font-size: 14px;
    color: var(--muted);
    margin-top: 6px;
    line-height: 1.6;
  }

  /* CARD */
  .card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 28px;
    margin-bottom: 20px;
    position: relative;
  }
  .card-label {
    font-size: 12px;
    font-weight: 700;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    color: var(--gold);
    margin-bottom: 16px;
  }

  /* FORM FIELDS */
  .field-group {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin-bottom: 16px;
  }
  .field-group.full { grid-template-columns: 1fr; }
  .field-group.three { grid-template-columns: 1fr 1fr 1fr; }

  .field {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  .field label {
    font-size: 13px;
    font-weight: 500;
    color: var(--ink);
  }
  .field input,
  .field select,
  .field textarea {
    border: 1.5px solid var(--border);
    border-radius: 8px;
    padding: 10px 14px;
    font-size: 14px;
    font-family: 'Heebo', sans-serif;
    color: var(--ink);
    background: #fff;
    transition: border-color 0.2s, box-shadow 0.2s;
    outline: none;
    width: 100%;
  }
  .field input:focus,
  .field select:focus,
  .field textarea:focus {
    border-color: var(--gold);
    box-shadow: 0 0 0 3px rgba(201,168,76,0.15);
  }
  .field textarea {
    resize: vertical;
    min-height: 80px;
  }

  /* FILE UPLOAD */
  .upload-zone {
    border: 2px dashed var(--border);
    border-radius: 10px;
    padding: 28px 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
    background: rgba(201,168,76,0.02);
    position: relative;
  }
  .upload-zone:hover, .upload-zone.dragover {
    border-color: var(--gold);
    background: rgba(201,168,76,0.06);
  }
  .upload-zone input[type="file"] {
    position: absolute;
    inset: 0;
    opacity: 0;
    cursor: pointer;
    width: 100%;
    height: 100%;
  }
  .upload-icon {
    font-size: 32px;
    margin-bottom: 8px;
  }
  .upload-text {
    font-size: 14px;
    color: var(--muted);
  }
  .upload-text strong {
    color: var(--deep);
  }
  .file-list {
    margin-top: 12px;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  .file-item {
    display: flex;
    align-items: center;
    gap: 10px;
    background: #f0f8f0;
    border: 1px solid #c3e6c3;
    border-radius: 6px;
    padding: 8px 12px;
    font-size: 13px;
  }
  .file-item-name { flex: 1; color: var(--success); }
  .file-item-remove {
    cursor: pointer;
    color: #999;
    font-size: 16px;
    line-height: 1;
    padding: 0 4px;
  }
  .file-item-remove:hover { color: var(--accent); }

  /* REPEAT ROWS */
  .repeat-row {
    display: grid;
    gap: 12px;
    align-items: end;
    margin-bottom: 12px;
    padding-bottom: 12px;
    border-bottom: 1px dashed var(--border);
  }
  .repeat-row:last-child {
    border-bottom: none;
    margin-bottom: 0;
    padding-bottom: 0;
  }
  .btn-remove-row {
    background: none;
    border: 1px solid #ddd;
    border-radius: 6px;
    padding: 8px 12px;
    cursor: pointer;
    color: #999;
    font-size: 18px;
    line-height: 1;
    transition: all 0.2s;
    height: 40px;
    display: flex;
    align-items: center;
  }
  .btn-remove-row:hover { border-color: var(--accent); color: var(--accent); }

  .btn-add-row {
    background: none;
    border: 1.5px dashed var(--gold);
    border-radius: 8px;
    padding: 10px 20px;
    cursor: pointer;
    color: var(--gold);
    font-size: 14px;
    font-family: 'Heebo', sans-serif;
    font-weight: 500;
    transition: all 0.2s;
    margin-top: 8px;
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }
  .btn-add-row:hover {
    background: rgba(201,168,76,0.08);
  }

  /* NAV BUTTONS */
  .nav-buttons {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 36px;
    padding-top: 24px;
    border-top: 1px solid var(--border);
  }
  .btn {
    padding: 12px 32px;
    border-radius: 8px;
    font-size: 15px;
    font-family: 'Heebo', sans-serif;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    border: none;
  }
  .btn-primary {
    background: var(--deep);
    color: #fff;
  }
  .btn-primary:hover {
    background: #16437e;
    transform: translateY(-1px);
    box-shadow: 0 4px 16px rgba(15,52,96,0.3);
  }
  .btn-secondary {
    background: none;
    border: 1.5px solid var(--border);
    color: var(--muted);
  }
  .btn-secondary:hover {
    border-color: var(--deep);
    color: var(--deep);
  }
  .btn-submit {
    background: var(--gold);
    color: var(--deep);
    font-weight: 700;
  }
  .btn-submit:hover {
    background: #b8963c;
    transform: translateY(-1px);
    box-shadow: 0 4px 16px rgba(201,168,76,0.4);
  }

  /* YEAR SELECTOR */
  .year-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: var(--deep);
    color: var(--gold);
    padding: 8px 18px;
    border-radius: 100px;
    font-size: 14px;
    font-weight: 700;
    margin-bottom: 32px;
  }

  /* SUCCESS */
  .success-screen {
    display: none;
    text-align: center;
    padding: 80px 40px;
  }
  .success-screen.active { display: block; }
  .success-icon {
    font-size: 72px;
    margin-bottom: 24px;
    animation: bounce 0.5s ease;
  }
  @keyframes bounce {
    0%,100% { transform: scale(1); }
    50% { transform: scale(1.2); }
  }
  .success-title {
    font-family: 'Frank Ruhl Libre', serif;
    font-size: 32px;
    color: var(--deep);
    margin-bottom: 12px;
  }
  .success-sub {
    color: var(--muted);
    font-size: 16px;
    max-width: 400px;
    margin: 0 auto;
    line-height: 1.6;
  }

  /* LOADING */
  .loading-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(245,240,232,0.9);
    z-index: 100;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 20px;
  }
  .loading-overlay.active { display: flex; }
  .spinner {
    width: 48px;
    height: 48px;
    border: 3px solid var(--border);
    border-top-color: var(--gold);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  /* SETUP BANNER */
  .setup-banner {
    background: linear-gradient(135deg, #1a1a2e, var(--deep));
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 32px;
    border: 1px solid rgba(201,168,76,0.3);
  }
  .setup-banner h3 {
    color: var(--gold);
    font-size: 14px;
    letter-spacing: 1px;
    text-transform: uppercase;
    margin-bottom: 10px;
  }
  .setup-banner p {
    color: rgba(255,255,255,0.7);
    font-size: 13px;
    line-height: 1.7;
  }
  .setup-banner code {
    background: rgba(255,255,255,0.1);
    padding: 2px 7px;
    border-radius: 4px;
    font-size: 12px;
    color: var(--gold-light);
  }
  .url-field {
    margin-top: 14px;
    display: flex;
    gap: 10px;
  }
  .url-field input {
    flex: 1;
    background: rgba(255,255,255,0.08);
    border: 1px solid rgba(201,168,76,0.4);
    border-radius: 8px;
    padding: 10px 14px;
    color: #fff;
    font-size: 13px;
    font-family: monospace;
    outline: none;
  }
  .url-field input::placeholder { color: rgba(255,255,255,0.3); }
  .url-field input:focus { border-color: var(--gold); }
  .url-save-btn {
    background: var(--gold);
    color: var(--deep);
    border: none;
    border-radius: 8px;
    padding: 10px 18px;
    cursor: pointer;
    font-family: 'Heebo', sans-serif;
    font-weight: 700;
    font-size: 13px;
    white-space: nowrap;
  }

  @media (max-width: 600px) {
    .header { padding: 28px 20px; }
    .progress-bar { padding: 0 20px 20px; }
    .field-group { grid-template-columns: 1fr; }
    .field-group.three { grid-template-columns: 1fr 1fr; }
  }
</style>
</head>
<body>

<div class="loading-overlay" id="loadingOverlay">
  <div class="spinner"></div>
  <div style="color: var(--deep); font-weight: 500;">×©×•×œ×— × ×ª×•× ×™×...</div>
</div>

<div class="header">
  <div class="header-inner">
    <div class="firm-name" id="firmNameDisplay">×××¡×œ× ×™×”×•×“×” â€” ×¨×•××™ ×—×©×‘×•×Ÿ ×•×™×•×¢×¦×™×</div>
    <h1>×˜×•×¤×¡ <span>×”×¦×”×¨×ª ×”×•×Ÿ</span></h1>
    <div class="header-sub">××œ× ××ª ×”×¤×¨×˜×™× ×‘×¦×•×¨×” ××¡×•×“×¨×ª â€” ×›×œ ×”×©×“×•×ª ×™×™×©×œ×—×• ×™×©×™×¨×•×ª ×œ××™×© ×”×§×©×¨ ×©×œ×š</div>
  </div>
</div>

<div class="progress-bar">
  <div class="progress-inner">
    <div class="step-group">
      <div class="step-dot active" onclick="goToSection(0)">1</div>
      <div class="step-label">×¤×¨×˜×™×</div>
    </div>
    <div class="step-line"></div>
    <div class="step-group">
      <div class="step-dot" onclick="goToSection(1)">2</div>
      <div class="step-label">×‘× ×§×™×</div>
    </div>
    <div class="step-line"></div>
    <div class="step-group">
      <div class="step-dot" onclick="goToSection(2)">3</div>
      <div class="step-label">× ×“×œ"×Ÿ</div>
    </div>
    <div class="step-line"></div>
    <div class="step-group">
      <div class="step-dot" onclick="goToSection(3)">4</div>
      <div class="step-label">×¨×›×‘×™×</div>
    </div>
    <div class="step-line"></div>
    <div class="step-group">
      <div class="step-dot" onclick="goToSection(4)">5</div>
      <div class="step-label">×ª×›×•×œ×”</div>
    </div>
    <div class="step-line"></div>
    <div class="step-group">
      <div class="step-dot" onclick="goToSection(5)">6</div>
      <div class="step-label">×—×•×‘×•×ª</div>
    </div>
    <div class="step-line"></div>
    <div class="step-group">
      <div class="step-dot" onclick="goToSection(6)">7</div>
      <div class="step-label">××—×¨</div>
    </div>
  </div>
</div>

<div class="main">

  <!-- SETUP BANNER (admin only - hidden by ?admin=1) -->
  <div class="setup-banner" id="setupBanner" style="display:none">
    <h3>âš™ï¸ ×”×’×“×¨×ª ×—×™×‘×•×¨ ×œ-Google Sheets</h3>
    <p>×”×“×‘×§ ×›××Ÿ ××ª ×›×ª×•×‘×ª ×”-<code>Web App URL</code> ×©×§×™×‘×œ×ª ×-Google Apps Script, ×•×œ×—×¥ ×©××•×¨:</p>
    <div class="url-field">
      <input type="text" id="scriptUrlInput" placeholder="https://script.google.com/macros/s/..." />
      <button class="url-save-btn" onclick="saveScriptUrl()">×©××•×¨</button>
    </div>
    <p style="margin-top:10px; font-size:12px; opacity:0.6;">×”×›×ª×•×‘×ª × ×©××¨×ª ×‘×“×¤×“×¤×Ÿ ×‘×œ×‘×“. ×›×œ ××™ ×©×¤×•×ª×— ××ª ×”×“×£ ×™×©×ª××© ×‘×” ××—×¨×™ ×©×ª×¤×™×¦/×™ ××ª ×”×§×™×©×•×¨.</p>
  </div>

  <!-- YEAR SELECTOR -->
  <div class="year-badge">
    ğŸ“… ×©× ×ª ×”××¡:
    <select id="taxYear" style="background:none;border:none;color:var(--gold);font-weight:700;font-size:14px;cursor:pointer;outline:none;font-family:'Heebo',sans-serif;">
      <option>2030</option>
      <option>2029</option>
      <option>2028</option>
      <option>2027</option>
      <option>2026</option>
      <option>2025</option>
      <option selected>2024</option>
    </select>
  </div>

  <!-- SECTION 0: CLIENT DETAILS -->
  <div class="section active" id="section-0">
    <div class="section-header">
      <div class="section-number">0</div>
      <div>
        <div class="section-title">×¤×¨×˜×™ ×”×œ×§×•×—</div>
        <div class="section-desc">××™×“×¢ ×‘×¡×™×¡×™ ×©×™××¤×©×¨ ×œ× ×• ×œ×–×”×•×ª ××ª ×”×ª×™×§ ×©×œ×š</div>
      </div>
    </div>
    <div class="card">
      <div class="card-label">××’×™×© / ××©×¤×—×”</div>
      <div class="field-group">
        <div class="field">
          <label>×©× ××œ× (××’×™×© ×¨××©×™) *</label>
          <input type="text" id="name" placeholder="×™×©×¨××œ ×™×©×¨××œ×™" required />
        </div>
        <div class="field">
          <label>×ª×¢×•×“×ª ×–×”×•×ª *</label>
          <input type="text" id="id_num" placeholder="000000000" />
        </div>
      </div>
      <div class="field-group">
        <div class="field">
          <label>×©× ×‘×Ÿ/×‘×ª ×–×•×’</label>
          <input type="text" id="spouse_name" placeholder="×©×¨×” ×™×©×¨××œ×™" />
        </div>
        <div class="field">
          <label>×ª.×–. ×‘×Ÿ/×‘×ª ×–×•×’</label>
          <input type="text" id="spouse_id" placeholder="000000000" />
        </div>
      </div>
      <div class="field-group">
        <div class="field">
          <label>×˜×œ×¤×•×Ÿ *</label>
          <input type="tel" id="phone" placeholder="050-0000000" />
        </div>
        <div class="field">
          <label>×“×•×"×œ *</label>
          <input type="email" id="email" placeholder="name@email.com" />
        </div>
      </div>
      <div class="field-group full">
        <div class="field">
          <label>×™×œ×“×™× ××ª×—×ª ×œ×’×™×œ 18 (×©××•×ª ×•×ª××¨×™×›×™ ×œ×™×“×”)</label>
          <textarea id="children" placeholder="×œ××©×œ: ×™×•×¡×™ â€” 15/03/2010, ×¨×—×œ â€” 22/09/2015"></textarea>
        </div>
      </div>
    </div>
    <div class="nav-buttons">
      <div></div>
      <button class="btn btn-primary" onclick="nextSection()">×”××©×š â†</button>
    </div>
  </div>

  <!-- SECTION 1: BANKS -->
  <div class="section" id="section-1">
    <div class="section-header">
      <div class="section-number">1</div>
      <div>
        <div class="section-title">××™×©×•×¨×™ ×‘× ×§×™× ×•×™×ª×¨×•×ª</div>
        <div class="section-desc">×™×ª×¨×•×ª ×œ×™×•× 31 ×‘×“×¦××‘×¨ <span class="yr">2022</span> â€” ×—×©×‘×•×Ÿ ×¢×•"×©, ×—×™×¡×›×•×Ÿ, × ×™"×¢, ×§×•×¤×•×ª ×’××œ, ××˜"×—, ×œ×¨×‘×•×ª ×©×œ ×‘×Ÿ/×‘×ª ×–×•×’ ×•×™×œ×“×™× ××ª×—×ª ×œ×’×™×œ 18</div>
      </div>
    </div>
    <div class="card">
      <div class="card-label">×¤×™×¨×•×˜ ×—×©×‘×•× ×•×ª</div>
      <div id="bankRows"></div>
      <button class="btn-add-row" onclick="addRow('bankRows', bankRowTemplate)">+ ×”×•×¡×£ ×—×©×‘×•×Ÿ</button>
    </div>
    <div class="card">
      <div class="card-label">×”×¢×œ××ª ××¡××›×™× â€” ××™×©×•×¨×™ ×‘× ×§</div>
      <div class="upload-zone" id="zone-bank">
        <input type="file" multiple accept=".pdf,.jpg,.jpeg,.png" onchange="handleFiles(this,'bank')">
        <div class="upload-icon">ğŸ“„</div>
        <div class="upload-text"><strong>×’×¨×•×¨ ×œ×›××Ÿ ×§×‘×¦×™×</strong> ××• ×œ×—×¥ ×œ×‘×—×™×¨×”</div>
        <div class="upload-text" style="font-size:12px;margin-top:4px;">PDF, JPG, PNG ×¢×“ 10MB ×œ×§×•×‘×¥</div>
      </div>
      <div class="file-list" id="files-bank"></div>
    </div>
    <div class="nav-buttons">
      <button class="btn btn-secondary" onclick="prevSection()">â†’ ×—×–×•×¨</button>
      <button class="btn btn-primary" onclick="nextSection()">×”××©×š â†</button>
    </div>
  </div>

  <!-- SECTION 2: REAL ESTATE -->
  <div class="section" id="section-2">
    <div class="section-header">
      <div class="section-number">2</div>
      <div>
        <div class="section-title">× ×“×œ"×Ÿ ×•× ×›×¡×™ ××§×¨×§×¢×™×Ÿ</div>
        <div class="section-desc">×“×™×¨×•×ª, ×§×¨×§×¢×•×ª, × ×›×¡×™× ××¡×—×¨×™×™× â€” ×›×•×œ×œ ×—×•×–×™ ×¨×›×™×©×” ×•××¡××›×™ ×‘×¢×œ×•×ª</div>
      </div>
    </div>
    <div class="card">
      <div class="card-label">× ×›×¡×™×</div>
      <div id="realEstateRows"></div>
      <button class="btn-add-row" onclick="addRow('realEstateRows', realEstateRowTemplate)">+ ×”×•×¡×£ × ×›×¡</button>
    </div>
    <div class="card">
      <div class="card-label">×”×¢×œ××ª ×—×•×–×™ ×¨×›×™×©×” ×•××¡××›×™×</div>
      <div class="upload-zone">
        <input type="file" multiple accept=".pdf,.jpg,.jpeg,.png" onchange="handleFiles(this,'realestate')">
        <div class="upload-icon">ğŸ </div>
        <div class="upload-text"><strong>×’×¨×•×¨ ×œ×›××Ÿ ×§×‘×¦×™×</strong> ××• ×œ×—×¥ ×œ×‘×—×™×¨×”</div>
      </div>
      <div class="file-list" id="files-realestate"></div>
    </div>
    <div class="nav-buttons">
      <button class="btn btn-secondary" onclick="prevSection()">â†’ ×—×–×•×¨</button>
      <button class="btn btn-primary" onclick="nextSection()">×”××©×š â†</button>
    </div>
  </div>

  <!-- SECTION 3: VEHICLES -->
  <div class="section" id="section-3">
    <div class="section-header">
      <div class="section-number">3</div>
      <div>
        <div class="section-title">×›×œ×™ ×¨×›×‘</div>
        <div class="section-desc">×›×œ ×”×¨×›×‘×™× ×©×‘×¨×©×•×ª×›× â€” ×›×•×œ×œ ××¡××›×™ ×¨×›×™×©×”</div>
      </div>
    </div>
    <div class="card">
      <div class="card-label">×¤×¨×˜×™ ×›×œ×™ ×”×¨×›×‘</div>
      <div id="vehicleRows"></div>
      <button class="btn-add-row" onclick="addRow('vehicleRows', vehicleRowTemplate)">+ ×”×•×¡×£ ×¨×›×‘</button>
    </div>
    <div class="card">
      <div class="card-label">××¡××›×™ ×¨×›×™×©×”</div>
      <div class="upload-zone">
        <input type="file" multiple accept=".pdf,.jpg,.jpeg,.png" onchange="handleFiles(this,'vehicles')">
        <div class="upload-icon">ğŸš—</div>
        <div class="upload-text"><strong>×’×¨×•×¨ ×œ×›××Ÿ ×§×‘×¦×™×</strong> ××• ×œ×—×¥ ×œ×‘×—×™×¨×”</div>
      </div>
      <div class="file-list" id="files-vehicles"></div>
    </div>
    <div class="nav-buttons">
      <button class="btn btn-secondary" onclick="prevSection()">â†’ ×—×–×•×¨</button>
      <button class="btn btn-primary" onclick="nextSection()">×”××©×š â†</button>
    </div>
  </div>

  <!-- SECTION 4: CONTENTS -->
  <div class="section" id="section-4">
    <div class="section-header">
      <div class="section-number">4</div>
      <div>
        <div class="section-title">×ª×›×•×œ×ª ×”×‘×™×ª</div>
        <div class="section-desc">×¤×¨×™×˜×™× ×™×§×¨×™ ×¢×¨×š: ×ª×›×©×™×˜×™×, ××× ×•×ª, ××›×©×™×¨×™ ×—×©××œ, ×¨×™×”×•×˜ ×™×•×§×¨×” â€” ×™×© ×œ×¦×™×™×Ÿ ×©×•×•×™ ×‘×–××Ÿ ×”×¨×›×™×©×”</div>
      </div>
    </div>
    <div class="card">
      <div class="card-label">×¤×¨×™×˜×™×</div>
      <div id="contentRows"></div>
      <button class="btn-add-row" onclick="addRow('contentRows', contentRowTemplate)">+ ×”×•×¡×£ ×¤×¨×™×˜</button>
    </div>
    <div class="nav-buttons">
      <button class="btn btn-secondary" onclick="prevSection()">â†’ ×—×–×•×¨</button>
      <button class="btn btn-primary" onclick="nextSection()">×”××©×š â†</button>
    </div>
  </div>

  <!-- SECTION 5: DEBTS & LIABILITIES -->
  <div class="section" id="section-5">
    <div class="section-header">
      <div class="section-number">5</div>
      <div>
        <div class="section-title">×”×ª×—×™×™×‘×•×™×•×ª ×•×”×œ×•×•××•×ª</div>
        <div class="section-desc">×”×œ×•×•××•×ª ××‘× ×§×™×, ××•×¡×“×•×ª ×¤×™× × ×¡×™×™×, ×”×œ×•×•××•×ª ×¤×¨×˜×™×•×ª â€” ×™×© ×œ×¦×¨×£ ××™×©×•×¨×™×</div>
      </div>
    </div>
    <div class="card">
      <div class="card-label">×¤×™×¨×•×˜ ×—×•×‘×•×ª</div>
      <div id="debtRows"></div>
      <button class="btn-add-row" onclick="addRow('debtRows', debtRowTemplate)">+ ×”×•×¡×£ ×—×•×‘ / ×”×œ×•×•××”</button>
    </div>
    <div class="card">
      <div class="card-label">××¡××›×™ ×”×œ×•×•××•×ª ×•××™×©×•×¨×™×</div>
      <div class="upload-zone">
        <input type="file" multiple accept=".pdf,.jpg,.jpeg,.png" onchange="handleFiles(this,'debts')">
        <div class="upload-icon">ğŸ“‹</div>
        <div class="upload-text"><strong>×’×¨×•×¨ ×œ×›××Ÿ ×§×‘×¦×™×</strong> ××• ×œ×—×¥ ×œ×‘×—×™×¨×”</div>
      </div>
      <div class="file-list" id="files-debts"></div>
    </div>
    <div class="nav-buttons">
      <button class="btn btn-secondary" onclick="prevSection()">â†’ ×—×–×•×¨</button>
      <button class="btn btn-primary" onclick="nextSection()">×”××©×š â†</button>
    </div>
  </div>

  <!-- SECTION 6: OTHER -->
  <div class="section" id="section-6">
    <div class="section-header">
      <div class="section-number">6</div>
      <div>
        <div class="section-title">×¨×›×•×© ×•× ×›×¡×™× ××—×¨×™×</div>
        <div class="section-desc">×—×™×™×‘×™×, ×–×›××™×, ×”×©×§×¢×•×ª ××—×¨×•×ª, ×—×©×‘×•× ×•×ª ×‘×—×•"×œ, ×•×¢×•×“</div>
      </div>
    </div>
    <div class="card">
      <div class="card-label">×¤×™×¨×•×˜</div>
      <div id="otherRows"></div>
      <button class="btn-add-row" onclick="addRow('otherRows', otherRowTemplate)">+ ×”×•×¡×£ ×¤×¨×™×˜</button>
    </div>
    <div class="card">
      <div class="card-label">×”×¢×¨×•×ª ×›×œ×œ×™×•×ª</div>
      <div class="field">
        <textarea id="generalNotes" placeholder="×›×œ ××™×“×¢ × ×•×¡×£ ×©×—×©×•×‘ ×œ×“×¢×ª..." style="min-height:120px;width:100%;border:1.5px solid var(--border);border-radius:8px;padding:12px 14px;font-size:14px;font-family:'Heebo',sans-serif;outline:none;" onfocus="this.style.borderColor='var(--gold)'" onblur="this.style.borderColor='var(--border)'"></textarea>
      </div>
    </div>
    <div class="card">
      <div class="card-label">××¡××›×™× × ×•×¡×¤×™×</div>
      <div class="upload-zone">
        <input type="file" multiple accept=".pdf,.jpg,.jpeg,.png" onchange="handleFiles(this,'other')">
        <div class="upload-icon">ğŸ“</div>
        <div class="upload-text"><strong>×’×¨×•×¨ ×œ×›××Ÿ ×§×‘×¦×™×</strong> ××• ×œ×—×¥ ×œ×‘×—×™×¨×”</div>
      </div>
      <div class="file-list" id="files-other"></div>
    </div>
    <div class="nav-buttons">
      <button class="btn btn-secondary" onclick="prevSection()">â†’ ×—×–×•×¨</button>
      <button class="btn btn-submit" onclick="submitForm()">âœ“ ×©×œ×— ×”×¦×”×¨×ª ×”×•×Ÿ</button>
    </div>
  </div>

  <!-- SUCCESS -->
  <div class="success-screen" id="successScreen">
    <div class="success-icon">âœ…</div>
    <div class="success-title">×”×˜×•×¤×¡ × ×©×œ×— ×‘×”×¦×œ×—×”!</div>
    <div class="success-sub">×”× ×ª×•× ×™× ×©×œ×š ×”×•×¢×‘×¨×• ×œ××™×© ×”×§×©×¨ ×©×œ×š ×‘-Google Sheets. ×ª×§×‘×œ/×™ ××™×©×•×¨ ×‘×“×•×"×œ ×‘×§×¨×•×‘.</div>
    <button class="btn btn-secondary" style="margin-top:32px;" onclick="location.reload()">××œ× ×˜×•×¤×¡ × ×•×¡×£</button>
  </div>

</div><!-- /main -->

<script>
// ===== CONFIGURATION =====
let SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbypZK2I9uoUesEta4q2kXxKBVTwx437dSNOcqYUUdsl2ZgpaYMepFOqtBI41_zmvk0b/exec';
const FIRM_NAME = localStorage.getItem('hatzarat_firm') || '×××¡×œ× ×™×”×•×“×” â€” ×¨×•××™ ×—×©×‘×•×Ÿ ×•×™×•×¢×¦×™×';

// Admin panel
const params = new URLSearchParams(location.search);
if (params.get('admin') === '1') {
  document.getElementById('setupBanner').style.display = 'block';
  document.getElementById('scriptUrlInput').value = SCRIPT_URL;
}
document.getElementById('firmNameDisplay').textContent = FIRM_NAME;

function saveScriptUrl() {
  const val = document.getElementById('scriptUrlInput').value.trim();
  if (val) {
    localStorage.setItem('hatzarat_script_url', val);
    SCRIPT_URL = val;
    alert('× ×©××¨! ×¢×›×©×™×• ×ª×•×›×œ/×™ ×œ×©×ª×£ ××ª ×”×§×™×©×•×¨ ×¢× ×”×œ×§×•×—×•×ª.');
  }
}

// ===== STATE =====
const uploadedFiles = { bank: [], realestate: [], vehicles: [], debts: [], other: [] };
let currentSection = 0;
const totalSections = 7;

// ===== NAVIGATION =====
function goToSection(n) {
  if (n < 0 || n >= totalSections) return;
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.getElementById('section-' + n).classList.add('active');
  document.querySelectorAll('.step-dot').forEach((dot, i) => {
    dot.classList.remove('active','done');
    if (i < n) dot.classList.add('done');
    if (i === n) dot.classList.add('active');
  });
  currentSection = n;
  window.scrollTo({ top: 0, behavior: 'smooth' });
}
function nextSection() { goToSection(currentSection + 1); }
function prevSection() { goToSection(currentSection - 1); }

// ===== ROW TEMPLATES =====
const bankRowTemplate = () => `
  <div class="repeat-row" style="grid-template-columns: 1fr 1fr 1fr 1fr auto;">
    <div class="field"><label>×‘× ×§</label><input type="text" placeholder="×œ××•××™" class="bank-name"/></div>
    <div class="field"><label>×¡× ×™×£ / ×—×©×‘×•×Ÿ</label><input type="text" placeholder="123 / 456789" class="bank-account"/></div>
    <div class="field"><label>×¡×•×’ ×—×©×‘×•×Ÿ</label>
      <select class="bank-type">
        <option>×¢×•"×©</option><option>×—×™×¡×›×•×Ÿ</option><option>× ×™"×¢</option>
        <option>×§×•×¤×ª ×’××œ</option><option>××˜"×—</option><option>××—×¨</option>
      </select>
    </div>
    <div class="field"><label>×™×ª×¨×” ×‘×™×•× ×”×‘×¡×™×¡ (â‚ª)</label><input type="number" placeholder="0" class="bank-balance"/></div>
    <button class="btn-remove-row" onclick="removeRow(this)">Ã—</button>
  </div>`;

const realEstateRowTemplate = () => `
  <div class="repeat-row" style="grid-template-columns: 2fr 1fr 1fr 1fr auto;">
    <div class="field"><label>×›×ª×•×‘×ª ×”× ×›×¡</label><input type="text" placeholder="×¨×—×•×‘, ×¢×™×¨" class="re-address"/></div>
    <div class="field"><label>×¡×•×’</label>
      <select class="re-type">
        <option>×“×™×¨×” ×œ××’×•×¨×™×</option><option>×“×™×¨×” ×œ×”×©×§×¢×”</option>
        <option>×§×¨×§×¢</option><option>××¡×—×¨×™</option><option>××—×¨</option>
      </select>
    </div>
    <div class="field"><label>×©× ×ª ×¨×›×™×©×”</label><input type="number" placeholder="2010" class="re-year"/></div>
    <div class="field"><label>×¢×œ×•×ª ×¨×›×™×©×” (â‚ª)</label><input type="number" placeholder="0" class="re-cost"/></div>
    <button class="btn-remove-row" onclick="removeRow(this)">Ã—</button>
  </div>`;

const vehicleRowTemplate = () => `
  <div class="repeat-row" style="grid-template-columns: 1fr 1fr 1fr 1fr auto;">
    <div class="field"><label>×™×¦×¨×Ÿ ×•×“×’×</label><input type="text" placeholder="×˜×•×™×•×˜×” ×§×•×¨×•×œ×”" class="v-model"/></div>
    <div class="field"><label>×©× ×ª ×™×¦×•×¨</label><input type="number" placeholder="2020" class="v-year"/></div>
    <div class="field"><label>××¡×¤×¨ ×¨×™×©×•×™</label><input type="text" placeholder="12-345-67" class="v-plate"/></div>
    <div class="field"><label>××—×™×¨ ×¨×›×™×©×” (â‚ª)</label><input type="number" placeholder="0" class="v-price"/></div>
    <button class="btn-remove-row" onclick="removeRow(this)">Ã—</button>
  </div>`;

const contentRowTemplate = () => `
  <div class="repeat-row" style="grid-template-columns: 2fr 1fr 1fr auto;">
    <div class="field"><label>×ª×™××•×¨ ×¤×¨×™×˜</label><input type="text" placeholder="×ª×›×©×™×˜ / ×¨×™×”×•×˜ / ××›×©×™×¨..." class="c-desc"/></div>
    <div class="field"><label>×§×˜×’×•×¨×™×”</label>
      <select class="c-cat">
        <option>×ª×›×©×™×˜×™×</option><option>×¨×™×”×•×˜</option><option>××›×©×™×¨×™ ×—×©××œ</option>
        <option>××× ×•×ª / ××¡×¤× ×•×ª</option><option>××—×¨</option>
      </select>
    </div>
    <div class="field"><label>×©×•×•×™ ×‘×¨×›×™×©×” (â‚ª)</label><input type="number" placeholder="0" class="c-value"/></div>
    <button class="btn-remove-row" onclick="removeRow(this)">Ã—</button>
  </div>`;

const debtRowTemplate = () => `
  <div class="repeat-row" style="grid-template-columns: 1fr 1fr 1fr 1fr auto;">
    <div class="field"><label>××œ×•×•×”</label><input type="text" placeholder="×‘× ×§ / ××“× ×¤×¨×˜×™..." class="d-lender"/></div>
    <div class="field"><label>×¡×•×’</label>
      <select class="d-type">
        <option>××©×›× ×ª×”</option><option>×”×œ×•×•××” ××™×©×™×ª</option><option>×”×œ×•×•××” ×¢×¡×§×™×ª</option>
        <option>×›×¨×˜×™×¡ ××©×¨××™</option><option>×—×•×‘ ×¤×¨×˜×™</option><option>××—×¨</option>
      </select>
    </div>
    <div class="field"><label>×™×ª×¨×ª ×—×•×‘ (â‚ª)</label><input type="number" placeholder="0" class="d-balance"/></div>
    <div class="field"><label>×ª××¨×™×š ×¤×™×¨×¢×•×Ÿ</label><input type="date" class="d-end"/></div>
    <button class="btn-remove-row" onclick="removeRow(this)">Ã—</button>
  </div>`;

const otherRowTemplate = () => `
  <div class="repeat-row" style="grid-template-columns: 2fr 1fr 1fr auto;">
    <div class="field"><label>×ª×™××•×¨</label><input type="text" placeholder="×—×™×™×‘×™×, ×–×›××™×, ×™×¨×•×©×”..." class="o-desc"/></div>
    <div class="field"><label>×¡×•×’</label>
      <select class="o-type">
        <option>×—×™×™×‘ ×œ×™</option><option>×× ×™ ×—×™×™×‘</option><option>×”×©×§×¢×” ××—×¨×ª</option>
        <option>×—×©×‘×•×Ÿ ×‘×—×•"×œ</option><option>××—×¨</option>
      </select>
    </div>
    <div class="field"><label>×¡×›×•× / ×©×•×•×™ (â‚ª)</label><input type="number" placeholder="0" class="o-val"/></div>
    <button class="btn-remove-row" onclick="removeRow(this)">Ã—</button>
  </div>`;

function addRow(containerId, templateFn) {
  const container = document.getElementById(containerId);
  const div = document.createElement('div');
  div.innerHTML = templateFn();
  container.appendChild(div.firstElementChild);
}

function removeRow(btn) {
  btn.closest('.repeat-row').remove();
}

// ===== FILE HANDLING =====
function handleFiles(input, category) {
  const files = Array.from(input.files);
  uploadedFiles[category].push(...files);
  renderFileList(category);
}

function renderFileList(category) {
  const container = document.getElementById('files-' + category);
  if (!container) return;
  container.innerHTML = uploadedFiles[category].map((f, i) => `
    <div class="file-item">
      <span>ğŸ“</span>
      <span class="file-item-name">${f.name}</span>
      <span style="color:var(--muted);font-size:12px;">${(f.size/1024).toFixed(0)}KB</span>
      <span class="file-item-remove" onclick="removeFile('${category}',${i})">Ã—</span>
    </div>`).join('');
}

function removeFile(category, index) {
  uploadedFiles[category].splice(index, 1);
  renderFileList(category);
}

// ===== COLLECT DATA =====
function collectRows(containerId, fields) {
  const rows = document.getElementById(containerId)?.querySelectorAll('.repeat-row') || [];
  return Array.from(rows).map(row => {
    const obj = {};
    fields.forEach(f => { obj[f.key] = row.querySelector('.' + f.cls)?.value || ''; });
    return obj;
  });
}

function collectAllData() {
  return {
    taxYear: document.getElementById('taxYear').value,
    client: {
      name: document.getElementById('name').value,
      id: document.getElementById('id_num').value,
      spouseName: document.getElementById('spouse_name').value,
      spouseId: document.getElementById('spouse_id').value,
      phone: document.getElementById('phone').value,
      email: document.getElementById('email').value,
      children: document.getElementById('children').value,
    },
    banks: collectRows('bankRows', [
      {key:'bank', cls:'bank-name'}, {key:'account', cls:'bank-account'},
      {key:'type', cls:'bank-type'}, {key:'balance', cls:'bank-balance'}
    ]),
    realEstate: collectRows('realEstateRows', [
      {key:'address', cls:'re-address'}, {key:'type', cls:'re-type'},
      {key:'year', cls:'re-year'}, {key:'cost', cls:'re-cost'}
    ]),
    vehicles: collectRows('vehicleRows', [
      {key:'model', cls:'v-model'}, {key:'year', cls:'v-year'},
      {key:'plate', cls:'v-plate'}, {key:'price', cls:'v-price'}
    ]),
    contents: collectRows('contentRows', [
      {key:'desc', cls:'c-desc'}, {key:'category', cls:'c-cat'}, {key:'value', cls:'c-value'}
    ]),
    debts: collectRows('debtRows', [
      {key:'lender', cls:'d-lender'}, {key:'type', cls:'d-type'},
      {key:'balance', cls:'d-balance'}, {key:'endDate', cls:'d-end'}
    ]),
    other: collectRows('otherRows', [
      {key:'desc', cls:'o-desc'}, {key:'type', cls:'o-type'}, {key:'value', cls:'o-val'}
    ]),
    notes: document.getElementById('generalNotes').value,
    filesSummary: Object.fromEntries(
      Object.entries(uploadedFiles).map(([k,v]) => [k, v.map(f => f.name)])
    ),
    submittedAt: new Date().toLocaleString('he-IL')
  };
}

// ===== SUBMIT =====
async function submitForm() {
  const name = document.getElementById('name').value.trim();
  if (!name) { alert('× × ×œ×”×–×™×Ÿ ×©× ×œ×§×•×—'); goToSection(0); return; }

  const data = collectAllData();

  if (!SCRIPT_URL) {
    // Demo mode â€” show data
    console.log('FORM DATA:', JSON.stringify(data, null, 2));
    alert('âš ï¸ ×œ× ×”×•×’×“×¨ Google Apps Script URL.\n\n×”× ×ª×•× ×™× ×”×•×“×¤×¡×• ×œ-Console.\n×œ×—×¥ F12 ×›×“×™ ×œ×¨××•×ª×.\n\n×›×“×™ ×œ×—×‘×¨ ×œ-Google Sheets, ×¤×ª×— ?admin=1 ×‘×›×ª×•×‘×ª ×”×“×£.');
    showSuccess();
    return;
  }

  document.getElementById('loadingOverlay').classList.add('active');

  try {
    // Upload files first (convert to base64)
    const filesData = {};
    for (const [cat, files] of Object.entries(uploadedFiles)) {
      filesData[cat] = await Promise.all(files.map(f => fileToBase64(f)));
    }
    data.files = filesData;

    const resp = await fetch(SCRIPT_URL, {
      method: 'POST',
      body: JSON.stringify(data)
    });
    const result = await resp.json();
    if (result.status === 'ok') {
      showSuccess();
    } else {
      throw new Error(result.message || '×©×’×™××”');
    }
  } catch (e) {
    alert('×©×’×™××” ×‘×©×œ×™×—×”: ' + e.message + '\n\n×”× ×ª×•× ×™× ×”×•×“×¤×¡×• ×œ-Console.');
    console.log('FORM DATA (fallback):', JSON.stringify(data, null, 2));
  } finally {
    document.getElementById('loadingOverlay').classList.remove('active');
  }
}

function fileToBase64(file) {
  return new Promise((res, rej) => {
    const r = new FileReader();
    r.onload = () => res({ name: file.name, type: file.type, data: r.result.split(',')[1] });
    r.onerror = rej;
    r.readAsDataURL(file);
  });
}

function showSuccess() {
  document.getElementById('loadingOverlay').classList.remove('active');
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.querySelector('.year-badge').style.display = 'none';
  document.getElementById('setupBanner').style.display = 'none';
  document.getElementById('successScreen').classList.add('active');
}

// ===== UPDATE YEAR REFS =====
document.getElementById('taxYear').addEventListener('change', function() {
  document.querySelectorAll('.yr').forEach(el => el.textContent = this.value);
});

// ===== INIT ROWS =====
addRow('bankRows', bankRowTemplate);
addRow('realEstateRows', realEstateRowTemplate);
addRow('vehicleRows', vehicleRowTemplate);
addRow('contentRows', contentRowTemplate);
addRow('debtRows', debtRowTemplate);
addRow('otherRows', otherRowTemplate);

// ===== DRAG & DROP =====
document.querySelectorAll('.upload-zone').forEach(zone => {
  zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('dragover'); });
  zone.addEventListener('dragleave', () => zone.classList.remove('dragover'));
  zone.addEventListener('drop', e => {
    e.preventDefault();
    zone.classList.remove('dragover');
    const input = zone.querySelector('input[type=file]');
    // Trigger the file handler manually
    const dt = e.dataTransfer;
    if (dt.files.length && input.onchange) {
      Object.defineProperty(input, 'files', { value: dt.files, writable: true });
      input.onchange({ target: input });
    }
  });
});
</script>
</body>
</html>
