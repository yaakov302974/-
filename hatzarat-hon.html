<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>הצהרת הון — טופס לקוח</title>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;900&family=Frank+Ruhl+Libre:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --ink: #1a1a2e; --paper: #f5f0e8; --gold: #c9a84c; --deep: #0f3460;
            --muted: #6b6b7b; --border: #d4c9b0; --card: #fffdf7;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: 'Heebo', sans-serif; background: var(--paper); color: var(--ink);
            line-height: 1.6; overflow-x: hidden;
        }
        .header { background: var(--deep); padding: 30px 20px; text-align: center; color: white; }
        .firm-name { color: var(--gold); font-size: 12px; letter-spacing: 2px; margin-bottom: 10px; }
        .header h1 { font-family: 'Frank Ruhl Libre', serif; font-size: 28px; }
        
        .progress-bar { background: var(--deep); padding: 10px; border-bottom: 1px solid rgba(201,168,76,0.3); overflow-x: auto; white-space: nowrap; }
        .progress-inner { display: inline-flex; gap: 15px; padding: 0 10px; }
        .step-dot { width: 30px; height: 30px; border-radius: 50%; background: rgba(255,255,255,0.1); color: white; display: flex; align-items: center; justify-content: center; font-size: 12px; }
        .step-dot.active { background: var(--gold); color: var(--deep); font-weight: bold; }

        .main { max-width: 800px; margin: 0 auto; padding: 20px; padding-bottom: 100px; }
        .section { display: none; }
        .section.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 20px; margin-bottom: 20px; }
        .field { margin-bottom: 15px; display: flex; flex-direction: column; gap: 5px; }
        .field label { font-size: 14px; font-weight: 500; }
        input, select, textarea { width: 100%; padding: 12px; border: 1.5px solid var(--border); border-radius: 8px; font-size: 16px; background: white; }
        
        .repeat-row { border-bottom: 1px dashed var(--border); padding-bottom: 15px; margin-bottom: 15px; position: relative; }
        .btn-remove-row { color: #e94560; font-size: 14px; font-weight: bold; padding: 5px; margin-top: 5px; display: inline-block; cursor: pointer; }

        .nav-buttons {
            position: fixed; bottom: 0; left: 0; right: 0; background: white; 
            padding: 15px 20px; display: flex; justify-content: space-between; 
            box-shadow: 0 -5px 15px rgba(0,0,0,0.05); z-index: 100;
        }
        .btn { padding: 12px 25px; border-radius: 8px; font-weight: bold; border: none; cursor: pointer; font-size: 16px; }
        .btn-primary { background: var(--deep); color: white; }
        .btn-submit { background: var(--gold); color: var(--deep); }
        .btn-secondary { background: #eee; color: #666; }

        @media (max-width: 600px) {
            .header h1 { font-size: 22px; }
            .card { padding: 15px; }
        }
    </style>
</head>
<body>

<div class="header">
    <div class="firm-name">אמסלם יהודה — רואי חשבון</div>
    <h1>טופס הצהרת הון</h1>
</div>

<div class="progress-bar">
    <div class="progress-inner" id="stepIndicator">
        </div>
</div>

<div class="main">
    <form id="wealthForm">
        <div class="section active" id="section-0">
            <div class="card">
                <h3>פרטי לקוח</h3><br>
                <div class="field"><label>שם מלא *</label><input type="text" id="name" required></div>
                <div class="field"><label>תעודת זהות *</label><input type="tel" id="id_num" required></div>
                <div class="field"><label>טלפון *</label><input type="tel" id="phone" required></div>
                <div class="field"><label>דוא"ל</label><input type="email" id="email"></div>
            </div>
        </div>

        <div class="section" id="section-1">
            <h3>חשבונות בנק</h3>
            <div id="bankRows"></div>
            <button type="button" class="btn" style="border: 1px dashed var(--gold); width:100%; color:var(--gold);" onclick="addRow('bankRows', bankTemplate)">+ הוסף חשבון</button>
        </div>

        <div class="section" id="section-2">
            <h3>נדל"ן ונכסים</h3>
            <div id="reRows"></div>
            <button type="button" class="btn" style="border: 1px dashed var(--gold); width:100%; color:var(--gold);" onclick="addRow('reRows', reTemplate)">+ הוסף נכס</button>
        </div>

        <div class="section" id="section-3">
            <h3>כלי רכב</h3>
            <div id="vRows"></div>
            <button type="button" class="btn" style="border: 1px dashed var(--gold); width:100%; color:var(--gold);" onclick="addRow('vRows', vTemplate)">+ הוסף רכב</button>
        </div>

        <div class="section" id="section-4">
            <h3>הערות וסיום</h3>
            <div class="card">
                <div class="field"><label>הערות נוספות</label><textarea id="notes" rows="4"></textarea></div>
            </div>
        </div>
    </form>
</div>

<div class="nav-buttons">
    <button id="prevBtn" class="btn btn-secondary" onclick="prevSection()" style="visibility:hidden;">חזור</button>
    <button id="nextBtn" class="btn btn-primary" onclick="nextSection()">המשך ←</button>
</div>

<script>
    // הכתובת המעודכנת ששלחת מוטמעת כאן
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyKydaHzDtZQHLDJtLJb3IIBKhBviv7Jd7w8VAcWoi4lvUORQ9udNgitJEjioCgqcxg/exec'; 
    let currentSection = 0;
    const totalSections = 5;

    function updateSteps() {
        const container = document.getElementById('stepIndicator');
        container.innerHTML = '';
        for(let i=0; i<totalSections; i++) {
            const dot = document.createElement('div');
            dot.className = `step-dot ${i === currentSection ? 'active' : ''}`;
            dot.innerText = i + 1;
            container.appendChild(dot);
        }
    }

    function goToSection(n) {
        if (n === 0) document.getElementById('prevBtn').style.visibility = 'hidden';
        else document.getElementById('prevBtn').style.visibility = 'visible';

        if (n === totalSections - 1) {
            document.getElementById('nextBtn').innerText = 'שלח טופס';
            document.getElementById('nextBtn').classList.add('btn-submit');
        } else {
            document.getElementById('nextBtn').innerText = 'המשך ←';
            document.getElementById('nextBtn').classList.remove('btn-submit');
        }

        document.querySelectorAll('.section').forEach((s, i) => {
            s.classList.toggle('active', i === n);
        });
        currentSection = n;
        window.scrollTo(0,0);
        updateSteps();
    }

    function nextSection() {
        if (currentSection < totalSections - 1) {
            if (currentSection === 0) {
                if (!document.getElementById('name').value || !document.getElementById('phone').value) {
                    alert('נא למלא שם וטלפון');
                    return;
                }
            }
            goToSection(currentSection + 1);
        } else {
            submitForm();
        }
    }

    function prevSection() {
        if (currentSection > 0) goToSection(currentSection - 1);
    }

    function addRow(containerId, template) {
        const div = document.createElement('div');
        div.className = 'card repeat-row';
        div.innerHTML = template;
        document.getElementById(containerId).appendChild(div);
    }

    function removeRow(btn) { btn.parentElement.remove(); }

    const bankTemplate = `
        <div class="field"><label>בנק</label><input type="text" class="b-name"></div>
        <div class="field"><label>יתרה (₪)</label><input type="number" class="b-bal"></div>
        <span class="btn-remove-row" onclick="removeRow(this)">מחק חשבון</span>
    `;
    const reTemplate = `
        <div class="field"><label>כתובת</label><input type="text" class="re-addr"></div>
        <div class="field"><label>עלות רכישה</label><input type="number" class="re-cost"></div>
        <span class="btn-remove-row" onclick="removeRow(this)">מחק נכס</span>
    `;
    const vTemplate = `
        <div class="field"><label>דגם רכב</label><input type="text" class="v-model"></div>
        <div class="field"><label>מספר רכב</label><input type="text" class="v-num"></div>
        <span class="btn-remove-row" onclick="removeRow(this)">מחק רכב</span>
    `;

    async function submitForm() {
        const btn = document.getElementById('nextBtn');
        btn.disabled = true;
        btn.innerText = 'שולח...';

        const data = {
            submittedAt: new Date().toLocaleString('he-IL'),
            client: {
                name: document.getElementById('name').value,
                id: document.getElementById('id_num').value,
                phone: document.getElementById('phone').value,
                email: document.getElementById('email').value
            },
            notes: document.getElementById('notes').value
        };

        try {
            const resp = await fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors', // פותר בעיות תקשורת מסוימות
                body: JSON.stringify(data)
            });
            alert('הטופס נשלח בהצלחה!');
            location.reload();
        } catch (e) {
            alert('שגיאה בשליחה.');
            btn.disabled = false;
            btn.innerText = 'נסה שוב';
        }
    }

    updateSteps();
    addRow('bankRows', bankTemplate);
</script>
</body>
</html>
